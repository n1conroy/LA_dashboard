<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <script type="text/javascript" src="//code.jquery.com/jquery-1.6.4.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
 <title>Learning Analytics Dashboard</title>
  <meta charset="utf-8" name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />

  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <script src="//d26b395fwzu5fz.cloudfront.net/keen-analysis-1.2.2.js"></script>


  <link href="//d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.css" rel="stylesheet" />
  <script src="//d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.js"></script>
  <link rel="stylesheet" type="text/css" href="assets/lib/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="assets/css/keen-dashboards.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>

</head>

  <body class="application">

<div id="content">
<div class="navbar navbar-inverse navbar-fixed-top" style="height:800;" role="navigation">
<table class="top_links"><tr><td>
          <a class="navbar-brand" style="margin-top:10px" href="http://socialmedialab.ca/"><img alt="Social Media Lab" h
eight="60" width="225" src="http://socialmedialab.ca/wp-content/uploads/2016/11/Social_Media_Lab_Ryerson_TRSM_logo2016-1
.png" >
</a>
   <a class="navbar-brand" href="./"><h2>Learning Analytics Dashboard</h2><h4>Hashtag: #COURSE_HASHTAG</h4></a>
</td>

<td align=right valign=bottom>
 <br><br> <br>
   <font color="#FFFFF" size=3 weight=bold>Dashboard shows tweets for the past <b><span></span></b><form name="frm1" id=
"frm1">
</font>
<font color="black">
<select id="selectitem" name="catid" onChange="doReload(this.value); ">
        <option value="null">Select timeframe</option>
        <option value="this_1_week">1 week</option>
        <option value="this_2_weeks">2 weeks</option>
        <option value="this_3_weeks">3 weeks</option>
        <option value="this_4_weeks">1 month</option>
        <option value="this_8_weeks">2 months</option>
        <option value="this_12_weeks">3 months</option>
        <option value="this_16_weeks" >4 months</option>
</select>
   <noscript>
   <input type='submit'>
   </noscript>
   </form>
</td><td width=40></td></tr>
</table>
<br><br>
</div>



<div  id="content">

<br><br><br><br><br>  
   <font size=4 weight=bold>Posting Frequency
    <div  class="row">
      <div class="col-sm-4">
        <div class="chart-wrapper">
          <div class="chart-number"> [1] <b>Total posts</b> (<span></span>)</div>   
           <div class="chart-stage" id="total_chart">
            </div>
         <div class="chart-stage" id="post_line">
          </div>
          <div class="chart-notes">
             The total number of tweets during <span></span> using the hashtag #COURSE_HASHTAG  

          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="chart-wrapper">
           <div class="chart-number">[2]<b> Total number of posts each hour</b> </div>
  <div class="chart-stage" id="hour_chart">
          </div>
          <div class="chart-notes">
          The total number of tweets each hour using the hashtag #COURSE_HASHTAG 
           </div>
        </div>
      </div>
  
<div class="col-sm-4">
 <div class="chart-wrapper">
 <div class="chart-number">[3]<b> All tweets </b><br></div>
 <div class="chart-stage">
          PASTE_TWITTER_WIDGET_HERE 
  </div>
 </div>
</div>

 </div>
   <font size=4 weight=bold>Content Descriptions 
   <div class="row">
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-number">[4]<b> Content types </b> (<span></span>) </div> 
 <div class="chart-stage" id="con_chart">
          </div>
          <div class="chart-notes">
            Users can post various content, including hashtags, urls, user handles, multi-media or regular text. 
            The height of the graph represents the whole number of tweets for a particular day. Each coloured segment or <i>stack</i> represents a category (in this case the number of tweets with urls, hashtags, media, or user handles) that make up parts of the whole.   

</div>
        </div>
      </div>
    <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
           <div class="chart-number">[5]<b> Engagement type </b>(<span></span>)</div>  
  <div class="chart-stage" id="eng_chart">
          </div>
          <div class="chart-notes">
             Twitter users can create an original post, or retweet or reply to an existing tweet. The height of each bar represents the whole number of tweets for a particular day. Each coloured segment or <i>stack</i> represents a category (in this case the number of tweets that are replies, retweets, or original) that make up parts of the whole. 
          <br><br></div>
        </div>
      </div>
           <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
   <div class="chart-number">[6]<b> Sentiment type </b>(<span></span>)<br><font style="font-size:14px;"> <a target="_blank" href="sent_sub.html?source=COURSE_HASHTAG">See examples of tweets by sentiment type <img src="https://cdn.onlinewebfonts.com/svg/img_167295.png" height=14 width=14></a></font></div>
          <div class="chart-stage" id="spline_chart">
          </div>
          <div class="chart-notes">
              Sentiment describes the emotionality of the tweet, and whether it is positive, negative or neutral. <br> 
       We use the <a href="http://www.nltk.org/api/nltk.sentiment.html" >NLTK SentimentAnalyzer </a>, a Python package to implement and facilitate Sentiment Analysis tasks using NLTK features and classifiers. 
          <br> <br></div>
        </div>
      </div> 
   </div>    


<div class="row">
     <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-number">[7]<b> Subjectivity type</b> (<span></span>)<br> <font style="font-size:14px;"><a target="_blank" href="sent_sub.html?source=COURSE_HASHTAG">See examples of tweets by subjectivity type <img src="https://cdn.onlinewebfonts.com/svg/img_167295.png" height=14 width=14></a></font></div> 
 <div class="chart-stage" id="sub_chart">
          </div>
          <div class="chart-notes">
             Subjectivity is the degree of factuality or opinionated language in tweets. To calculate the subjectivity of sentences, we use the <a href="http://www.nltk.org/api/nltk.sentiment.html">NLTK subjectivity classifier</a>, trained on the Subjectivity Dataset (Pang & Lee, 2004).
          </div>
        </div>
      </div>
   <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-number">[8]<b> Top 10 Hashtags </b>(<span></span>) </div>
            <div class="chart-stage"id="hashtag_chart" >

</div>
          <div class="chart-notes">
             Hashtags contained in the tweet (excluding #COURSE_HASHTAG)<br><br><br>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-number">[9]<b> Top 10 named entities </b> (<span></span>)</div> 
 <div class="chart-stage" id="ne_chart" >
          </div>
          <div class="chart-notes">
           Named entities are proper names of persons, places, or organizations<br><br><br>
           </div>
        </div>
      </div>
    </div>
 

   User Information 
  <div class="row">
  <div class="col-sm-12 col-md-3">
        <div class="chart-wrapper">
           <div class="chart-number">[10]<b> Top 10 contributors </b>(<span></span>)<br><br></div>
  <div class="chart-stage" id="column_chart" >
          </div>
          <div class="chart-notes">
              Twitter users who post, retweet or reply most frequently 
          </div>
        </div>
      </div>
     




 <div class="col-sm- col-md-3">
        <div class="chart-wrapper">
  <div class="chart-number">[11]<b> Top 10 most negative</b> (<span></span>)<br><font style="font-size:14px;"> <a target="_blank" href="sent_sub.html?source=COURSE_HASHTAG">See examples of tweets by sentiment type <img src="https://cdn.onlinewebfonts.com/svg/img_167295.png" height=14 width=14></a></font></div>
          <div class="chart-stage" id="subbar_chart" >
          </div>
          <div class="chart-notes" >
              Users with most negative sentiment 
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-3">
        <div class="chart-wrapper">
<div class="chart-number">[12]<b> Top 10 most positive</b> (<span></span>)<br><font style="font-size:14px;"> <a target="_blank" href="sent_sub.html?source=COURSE_HASHTAG">See examples of tweets by sentiment type <img src="https://cdn.onlinewebfonts.com/svg/img_167295.png" height=14 width=14></a></font></div>
          <div class="chart-stage" id="sentbar_chart">
          </div>
          <div class="chart-notes">
               Users  with most positive sentiment 
          </div>
        </div>
      </div>
       <div class="col-sm-12 col-md-3">
        <div class="chart-wrapper">
  <div class="chart-number">[13]<b> Top 10 most mentioned</b> (<span></span>)<br><br></div>
          <div class="chart-stage" id="mentions_chart">
          </div>
          <div class="chart-notes">
               Users most mentioned 
          </div>
        </div>
      </div>
    </div>
 
 </div>
 </div> 
 </div>
 </div>
 </div>

</div>


<script type='text/javascript'>
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

var myhashtag='COURSE_HASHTAG' 

function getUrlParameter(name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    var results = regex.exec(location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
};

function doReload(catid){
  document.location = myhashtag+'/index.html?catid=' + catid;
};


function formatTime (val) {
    
    if (val == "this_1_week") {
       time_html= "1 week";
      }
    else if (val == "this_2_weeks") {
      time_html= "2 weeks";
      }
    else if (val == "this_3_weeks") {
      time_html ="3 weeks"; 
      }
    else if (val == "this_4_weeks") {
     time_html ="1 month"; 
     }
    else if (val == "this_8_weeks") {
     time_html ="2 months";
     }
    else if (val == "this_12_weeks") {
     time_html ="3 months";
     }
    else if (val == "this_16_weeks") {
     time_html ="4 months";
     }

   var sel=document.getElementById('content').getElementsByTagName('span');
   for (var i=0; i<sel.length; i++) {
sel[i].innerHTML=time_html; 
   }
}




function compareSecondColumn(a, b) {
    if (a[1] === b[1]) {
        return 0;
    }
    else {
        return (b[1] < a[1]) ? -1 : 1;
    }
}

function tabelajzing(a){
       return [
         "<tr>\n<th>",
         a.map(function (e, i) {
           return e.join("</th>\n<td>")
         }).join("</td></tr>\n<tr>\n<th>"),
         "</td>\n</tr>\n"
       ].join("")
     }

function readConfigFile() {
  var path="config/"+myhashtag+".config";
  var result=null;
  var params={};
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open('GET', path, false);
  xmlhttp.send();

  if (xmlhttp.status==200)  {
	result=xmlhttp.responseText;
  }
  var all= result.split('\n'); 
  for (i=0;i<all.length;i++){
      if (all[i].includes("KEEN_PROJECT_ID") ) {
	params['KEEN_PROJECT_ID']=all[i].split("=")[1];}
      else if (all[i].includes("KEEN_READ_KEY")) { 
	params['KEEN_READ_KEY']=all[i].split("=")[1];}
      }
 return params;
}

var mytime=getUrlParameter("catid");
if (!mytime || mytime=="null") {
  mytime="this_1_week";}

formatTime(mytime);

allConfig=readConfigFile();
file_projectId=allConfig['KEEN_PROJECT_ID'].replace(/"/g,"");
file_readKey=allConfig['KEEN_READ_KEY'].replace(/"/g,"");


var client = new Keen({
       projectId: file_projectId,
       readKey: file_readKey 
     }); 

var postchart = new Keen.Dataviz()
  .el('#post_line')
  .type("area")
  .height(300)
  .title(" ")
  .prepare();

var postquery= new Keen.Query("count", {
    event_collection: myhashtag,
    interval: "daily",
    timeframe: mytime,
    refresh_rate:28000,
    timezone: "US/Eastern"
  });


client.run(postquery, function(err, res){
     postchart
     .data(res)
     .render();
 });


var totalchart = new Keen.Dataviz()
  .el('#total_chart')
  .type("metric")
  .title(" ")
  .width(230)
  .height(140)
;

var totalquery= new Keen.Query("count",{
   event_collection: myhashtag,
   timeframe: mytime,
   refresh_rate:28000,
   timezone: "US/Eastern" });

client

.run (totalquery, function(err,res){
   totalchart
   .data(res)
   .render();
});


var hourchart = new Keen.Dataviz()
  .el('#hour_chart')
  .type("bar")
  .height(450)
  .title(" ")
  .colors(['purple'])
  .prepare();

var hourquery= new Keen.Query("count", {
    event_collection: myhashtag,
    timeframe: 'this_1_days',
    interval: 'hourly',
    target_property: "created_at",
    refresh_rate:28000,
    timezone: "US/Eastern"
  });

client.run(hourquery, function(err, res){
     hourchart
      .data(res)
      .render();
    });
Keen.ready(function(){

var sq1 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  target_property: 'sentiment_range',
  filters: [
          {
            property_name: "sentiment_range",
            operator : "eq",
            property_value : "positive"
          }
        ]
});

var sq2 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  target_property: 'sentiment_range',
  filters: [
          {
            property_name: "sentiment_range",
            operator : "eq",
            property_value : "negative"
          }
        ]
});

var sq3 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  timezone: "US/Eastern",
  refresh_rate: 28000,
  interval: 'daily',
  target_property: 'sentiment_range',
  filters: [
          {
            property_name: "sentiment_range",
            operator : "eq",
            property_value : "neutral"
          }
        ]
});



var sentchart = new Keen.Dataviz()
  .el('#spline_chart')
  .title(' ')
  .height(300)
  .type("spline")
  .colors(['green','red','blue'])
  .prepare();

client.run([sq1, sq2, sq3 ], function(err, res) {
  sentchart
    .data(res[0])
    .labelMapping({
      'Result': 'Positive'
    })
    .call(function() {
      var ds2 = Keen.Dataset.parser('interval')(res[1]);
      this.dataset.appendColumn('Negative', ds2.selectColumn(1).slice(1));
      var ds3 = Keen.Dataset.parser('interval')(res[2]);
      this.dataset.appendColumn('Neutral', ds3.selectColumn(1).slice(1));
    })
    .render();
});



});




var retweet = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
          {
            property_name: "retweeted",
            operator: "eq",
            property_value : "true"
          }
        ]
});

var replies = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate:28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
         {
        "operator": "exists",
        "property_name": "replied_to",
        "property_value": true
         },  
         {
            property_name: "replied_to",
            operator: "ne",
            property_value : null
          }
             
         
        ]
});


var origpost = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
       {
            property_name: "retweeted",
            operator: "eq",
            property_value : "false" 
          },

       {
            property_name: "replied_to",
            operator: "eq",
            property_value : null
          }

        ]
});



var engchart = new Keen.Dataviz()
  .el('#eng_chart')
  .title(' ')
  .height(300)
  .type("bar")
  .stacked(true)
  .colors(['red','green','blue'])
  .prepare();

client.run([retweet, replies, origpost ], function(err, res) {
   engchart
    .data(res[0])
    .labelMapping({
      'Result': 'Retweets'
    })
    .call(function() {
      var ds2 = Keen.Dataset.parser('interval')(res[1]);
      this.dataset.appendColumn('Replies', ds2.selectColumn(1).slice(1));
      var ds3 = Keen.Dataset.parser('interval')(res[2]);
      this.dataset.appendColumn('Original post', ds3.selectColumn(1).slice(1));

    })
    .render();
});


var con1 = new Keen.Query("count", {
  event_collection: myhashtag, 
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
          {
            property_name: "mentions1",
            operator : "not_contains",
            property_value : "None"
          }
        ]
});

var con2 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
          {
            property_name: "hashtag1",
            operator : "not_contains",
            property_value : "None"
          }
        ]
});

var con3 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
          {
            property_name: "urls1",
            operator : "not_contains",
            property_value : "None"
          }
        ]
});


var con4 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  refresh_rate: 28000,
  timezone: "US/Eastern",
  interval: 'daily',
  filters: [
          {
            property_name: "media",
            operator : "not_contains",
            property_value : "false"
          }
        ]
});

var conchart = new Keen.Dataviz()
  .el('#con_chart')
  .height(300)
  .title("  ")
  .type("area")
  .stacked(true)
  .colors(['red','green','blue','orange'])
  .prepare();

client.run([con1, con2, con3, con4], function(err, res) {
  conchart
    .data(res[0])
    .labelMapping({
      'Result': 'User mentions'
    })
    .call(function() {
      var ds2 = Keen.Dataset.parser('interval')(res[1]);
      this.dataset.appendColumn('Hashtags', ds2.selectColumn(1).slice(1));
      var ds3 = Keen.Dataset.parser('interval')(res[2]);
      this.dataset.appendColumn('URLs', ds3.selectColumn(1).slice(1));
      var ds4 = Keen.Dataset.parser('interval')(res[3]);
      this.dataset.appendColumn('Media', ds4.selectColumn(1).slice(1));

    })
    .render();
});

 client
        .query("count", {
          event_collection: myhashtag,
          group_by: ["hashtag2"],
          timeframe: mytime,
          refresh_rate:"28000",
          filters:[
               {property_name:"hashtag2",operator :"not_contains",property_value: "None"},
               {property_name:"hashtag2",operator :"not_contains",property_value: myhashtag}
           ],
          timezone: "US/Eastern"
        })
      .then(function(res) {
       templist=new Array();
       for (var i=0; i<res.result.length; i++){
           templist[i]=new Array;
           templist[i][0]=res.result[i].hashtag2;
           templist[i][1]=res.result[i].result; }
        templist.sort(compareSecondColumn);
        top_list=10;
        if (res.result.length<top_list) {
             top_list=res.result.length;}
        goodlist=new Array;
        for (var i=0; i<top_list; i++){
          goodlist[i]=new Array;
          goodlist[i][0]=templist[i][0];
          goodlist[i][1]=templist[i][1];
            }
           var options =[goodlist,['#2D2D45', '#3C3C5C','#4B4B73', '#5A5A8A','#6F6DA7','#8381B3','#9795BF','#ABA9CB','#BFBDD7','#D3D1E3'],'right'];
              drawChart(options, 'PieChart','hashtag_chart');
         })


 client
      .query("count", {
        event_collection: myhashtag,
        timeframe: mytime,
        timezone: "US/Eastern",
        refresh_rate:"28000",
        group_by:"named_entities",
filters:[              {
            property_name: "named_entities",
            operator : "not_contains",
            property_value : "None"
          },
          {
            property_name: "named_entities",
            operator: "exists",
            property_value : true
          },
   {
            property_name: "named_entities",
            operator: "not_contains",
            property_value : "none" 
          },
     {  property_name: "named_entities",
            operator: "not_contains",
            property_value : "& amp"
} 
        ]

         })
      .then(function(res) {
       templist=new Array();
       for (var i=0; i<res.result.length; i++){
           templist[i]=new Array;
           templist[i][0]=res.result[i].named_entities;
           templist[i][1]=res.result[i].result; }
        templist.sort(compareSecondColumn);
        top_list=10;
        if (res.result.length<top_list) {
             top_list=res.result.length;}
        goodlist=new Array;
        for (var i=0; i<top_list; i++){
          goodlist[i]=new Array;
          goodlist[i][0]=templist[i][0];
          goodlist[i][1]=templist[i][1];
            }
           var options =[goodlist,['#e0440e', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'], 'right']
              drawChart(options, 'PieChart','ne_chart');
         })


Keen.ready(function(){

var subq1 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  timezone: "US/Eastern",
  interval: 'daily',
  refresh_rate: 28000,
  target_property: 'subjectivity_range',
  filters: [
          {
            property_name: "subjectivity_range",
            operator : "eq",
            property_value : "subjective"
          }
        ]
});

var subq2 = new Keen.Query("count", {
  event_collection: myhashtag,
  timeframe: mytime,
  timezone: "US/Eastern",
  interval: 'daily',
  refresh_rate:28000,
  target_property: 'subjectivity_range',
  filters: [
          {
            property_name: "subjectivity_range",
            operator : "eq",
            property_value : "Non subjective"
          }
        ]
});

var subchart = new Keen.Dataviz()
  .el('#sub_chart')
  .title(' ')
  .height(300)
  .type("spline")
  .colors(['blue','pink'])
  .prepare();

client.run([subq1, subq2 ], function(err, res) {
  subchart
    .data(res[0])
    .labelMapping({
      'Result': 'Opinionated'
    })
    .call(function() {
      var ds2 = Keen.Dataset.parser('interval')(res[1]);
      this.dataset.appendColumn('Non opinionated', ds2.selectColumn(1).slice(1));
    })
    .render();
   });
});

Keen.ready(function() {

var userquery = new Keen.Query("count", {
        group_by: "username",
        refresh_rate: 28000,
        event_collection: myhashtag,
timezone: "US/Eastern",
        timeframe: mytime,
 filters: [
          {
            property_name: "retweeted",
            operator: "eq",
            property_value :"false" 
          },
  {
    property_name: "text",
    operator: "exists",
    property_value: true
  }        
]
    });

});



 client
      .query("count", {
        event_collection: myhashtag,
        group_by: ["username"],
        timeframe: mytime,
        refresh_rate:"28000",
        timezone: "US/Eastern"
      })
      .then(function(res) {
        var templist=new Array();
       for (var i=0; i<res.result.length; i++){
           templist[i]=new Array;
           templist[i][0]=res.result[i].username;
           templist[i][1]=res.result[i].result; }
        templist.sort(compareSecondColumn);
        top_list=10;
        if (res.result.length<top_list) {
             top_list=res.result.length;}
        var goodlist=new Array;
        for (var i=0; i<top_list; i++){
          goodlist[i]=new Array;
          goodlist[i][0]=templist[i][0];
          goodlist[i][1]=templist[i][1];
            }
            var options =[goodlist, ['purple'], 'none']; 
    drawChart(options,'BarChart','column_chart');
         })


 client
      .query("count", {
        event_collection: myhashtag,
        group_by: ["username"],
        timeframe: mytime,
        timezone: "US/Eastern",
        refresh_rate:"2800",
        target_property:'sentiment_range',
        filters:[              {
            property_name: "sentiment_range",
            operator : "eq",
            property_value : "positive"
          },
          {
            property_name: "text",
            operator: "exists",
            property_value : true
          }
        ]

         })
      .then(function(res) {
        templist=new Array();
       for (var i=0; i<res.result.length; i++){
           templist[i]=new Array;
           templist[i][0]=res.result[i].username;
           templist[i][1]=res.result[i].result; }
        templist.sort(compareSecondColumn);
        top_list=10;
        if (res.result.length<top_list) {
             top_list=res.result.length;}
        goodlist=new Array;
        for (var i=0; i<top_list; i++){
          goodlist[i]=new Array;
          goodlist[i][0]=templist[i][0];
          goodlist[i][1]=templist[i][1];
            }
             var options =[goodlist, ['green'], 'none'];
     drawChart(options,'BarChart','sentbar_chart'); 
         })

 
client
      .query("count", {
        event_collection: myhashtag,
        group_by: ["username"],
        timeframe: mytime,
        refresh_rate:"2800",
        timezone: "US/Eastern",
        target_property:'sentiment_range',
        filters:[              {
            property_name: "sentiment_range",
            operator : "eq",
            property_value : "negative"
          },
          {
            property_name: "text",
            operator: "exists",
            property_value : true
          }
        ]

         })
      .then(function(res) {
        templist=new Array();
       for (var i=0; i<res.result.length; i++){
           templist[i]=new Array;
           templist[i][0]=res.result[i].username;
           templist[i][1]=res.result[i].result; }
        templist.sort(compareSecondColumn);
        top_list=10;
        if (res.result.length<top_list) {
             top_list=res.result.length;}
        goodlist=new Array;
        for (var i=0; i<top_list; i++){
          goodlist[i]=new Array;
          goodlist[i][0]=templist[i][0];
          goodlist[i][1]=templist[i][1];
            }
            var options=[goodlist,['red'],'none'];
            drawChart(options,'BarChart','subbar_chart');

         })



  client
      .query("count", {
        event_collection:myhashtag, 
        timeframe: mytime,
        timezone: "US/Eastern",
        refresh_rate:"28000",
        group_by: ["mentions1"],
        filters:[              {
            property_name: "mentions1",
            operator : "ne",
            property_value : "null"
          },
          {
            property_name: "mentions1",
            operator: "not_contains",
            property_value :"None"
          }
        ]

         })
      .then(function(res) {
        templist=new Array();
       for (var i=0; i<res.result.length; i++){
           templist[i]=new Array;
           templist[i][0]=res.result[i].mentions1;
           templist[i][1]=res.result[i].result; }
        templist.sort(compareSecondColumn);
        top_list=10;
        if (res.result.length<top_list) {
             top_list=res.result.length;}
        goodlist=new Array;
        for (var i=0; i<top_list; i++){
          goodlist[i]=new Array;
          goodlist[i][0]=templist[i][0];
          goodlist[i][1]=templist[i][1];
            }
          var options =[goodlist,['blue'],'none'];  
   drawChart(options,'BarChart','mentions_chart');
         })




  var textq = new Keen.Query("extraction", {
     event_collection: myhashtag,
     timeframe: mytime,
     refresh_rate: "28000",
     property_names: ["username","text","keen.timestamp"],
     timezone:"US/Eastern",  
     filters :[ 
            {
property_name: "retweeted",
operator: "ne",
property_value: "true"
    }, {
 property_name: "text",
        operator: "not_contains",
        property_value: "RT "
}
]

});

function drawChart(inOptions,type,chartId)  {
var x=inOptions[0];
var color=inOptions[1];
var legend_flag=inOptions[2];

var data = new google.visualization.DataTable();
   data.addColumn('string', 'Username');
   data.addColumn('number', 'Frequency');
   data.addRows(x);

    var options = { 'width':500,
                       'height':300,
                       'hAxis':{textStyle:{fontSize: 7}},
                       'legend':legend_flag,
                       'colors':color,
                       'chartArea': {'width':'70%', 'height': '90%'}
        };
   if (type=="BarChart"){
        var chart = new google.visualization.BarChart(document.getElementById(chartId)); }
   if (type=="PieChart"){
        var chart = new google.visualization.PieChart(document.getElementById(chartId)); }

  function selectHandler() {
     var selectedItem = chart.getSelection()[0];
        if (selectedItem) {
           target = data.getValue(selectedItem.row, 0);
            if (type=='PieChart') {
                 if (chartId == 'hashtag_chart') {
                   linkString ="https://twitter.com/search?f=tweets&q=%23"+target+"%20%23"+myhashtag+"&src=typd ";}
                 else if (chartId  =='ne_chart') {
                    linkString="https://twitter.com/search?f=tweets&q=%22"+target+"%22%20%23"+myhashtag+"&src=typd";}
                }
          else if (type== 'BarChart') {
                 linkString ="https://twitter.com/search?f=tweets&q=from:"+target+"%20%23"+myhashtag+"&src=typd ";}
           window.open(linkString);
         }
       }

        google.visualization.events.addListener(chart, 'select', selectHandler);
        chart.draw(data, options);
      }

</script>

</body>

</html>
